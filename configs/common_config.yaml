seed: 42
device: "cuda:0"
train:
  epochs: 1000
  microbatches: 256           # how many micro-steps per epoch
  patches_per_batch: 8       # how many patches per micro-step
  accumulate_steps: 1        # set >1 if you want gradient accumulation
  optimizer:
    name: adam
    lr: 5.0e-4  # Lower for stability with transformers
    weight_decay: 1.0e-5
  early_stopping:
    enabled: false
    patience: 10000
    min_delta: 0
  loss_weights:
    res: 0.5 # 0.5
    bc: 20.0 # 0.0  # Increased weight for boundary conditions
    ic: 10
  loss_balancer:
    use_loss_balancer: true
    kind: dwa
    terms: [res, bc, ic]  # No IC for steady state
    alpha: 0.15
    gamma: 0.5
    update_every: 20
    ref_layer_name: "head.weight"
log:
  out_dir: "outputs"
  wandb:
    enabled: true
    project: "patchpinn_helmholtz2d"
    entity: null
    mode: "online"
eval:
  grid:
    nx: 61
    ny: 61
    nt: 31
  every: 3000
gradflow:
  enabled: false
  every: 500
  store_vectors: true
  wandb_hist: false
  max_keep: 20
  stop_at: 10000
  plot:
    enabled: true
    kde: true
    stats: true
    losses: ["bc", "res"]
    loss_kde: true
    loss_kde_filename: "gradflow_kde_losses.png"
    kde_filename: "gradflow_kde.png"
    stats_prefix: "gradflow_stats"
    max_cols: 4